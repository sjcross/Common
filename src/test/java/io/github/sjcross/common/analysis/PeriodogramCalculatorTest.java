package io.github.sjcross.common.analysis;

import org.apache.commons.math3.complex.Complex;
import org.junit.jupiter.api.Test;

import java.util.TreeMap;

import static org.junit.jupiter.api.Assertions.assertArrayEquals;
import static org.junit.jupiter.api.Assertions.assertEquals;

/**
 * Created by sc13967 on 22/05/2018.
 */
public class PeriodogramCalculatorTest {
    private double tolerance = 1E-10;

    @Test
    public void testPadSignal() throws Exception {
        double[] signalIn = getRawSignal();
        double[] actual = PeriodogramCalculator.padSignal(signalIn);
        double[] expected = getPaddedSignal();

        assertArrayEquals(expected,actual,tolerance);

    }

    @Test
    public void testCalculateFFT() throws Exception {
        double[] signal = getPaddedSignal();
        Complex[] actual = PeriodogramCalculator.calculateFFT(signal);
        Complex[] expected = getFFT();

        assertEquals(expected.length,actual.length);
        for (int i=0;i<expected.length;i++) {
            assertEquals(expected[i].getReal(),actual[i].getReal(),tolerance);
            assertEquals(expected[i].getImaginary(),actual[i].getImaginary(),tolerance);
        }
    }

    @Test
    public void testCalculatePSD() throws Exception {
        Complex[] fft = getFFT();
        double[] actual = PeriodogramCalculator.calculatePSD(fft,1);
        double[] expected = getPSD();

        assertArrayEquals(expected,actual,tolerance);

    }

    @Test
    public void testCalculateFrequency() throws Exception {
        double[] actual = PeriodogramCalculator.calculateFrequency(1,257);
        double[] expected = getFrequency();

        assertArrayEquals(expected,actual,tolerance);

    }

    @Test
    public void testCalculate() throws Exception {
        double[] signal = getRawSignal();
        double[] freq = getFrequency();
        double[] psd = getPSD();

        TreeMap<Double,Double> actual = PeriodogramCalculator.calculate(signal,1);
        assertEquals(257,actual.size());

        int i=0;
        for (double key:actual.keySet()) {
            assertEquals(freq[i],key,tolerance);
            assertEquals(psd[i++],actual.get(key),tolerance);
        }
    }

    @Test
    public void testGetMaxPowerFrequency() throws Exception {
        TreeMap<Double,Double> periodogram = getPeriodogram();
        double actual = PeriodogramCalculator.getMaxPowerFrequency(periodogram);
        double expected = 0.050781250000000;

        assertEquals(expected,actual,tolerance);

    }

    @Test
    public void testGetKeyFrequencies() throws Exception {
        TreeMap<Double,Double> periodogram = getPeriodogram();
        double[][] expected = getKeyFrequencies();
        double[][] actual = PeriodogramCalculator.getKeyFrequencies(periodogram,3);

        assertArrayEquals(expected[0],actual[0],tolerance);
        assertArrayEquals(expected[1],actual[1],tolerance);
        assertArrayEquals(expected[2],actual[2],tolerance);

    }

    @Test
    public void testFlattenPeak() throws Exception {
        TreeMap<Double,Double> actual = getPeriodogram();
        double[] expectedFirst = getFirstFlattenedPSD();
        double[] expectedSecond = getSecondFlattenedPSD();

        // Performing the first peak flattening
        PeriodogramCalculator.flattenPeak(actual,0.050781250000000);
        int i=0;
        for (double key:actual.keySet()) {
            assertEquals(expectedFirst[i++],actual.get(key),tolerance);
        }

        // Performing the second peak flattening
        PeriodogramCalculator.flattenPeak(actual,0.087890625000000);
        i=0;
        for (double key:actual.keySet()) {
            assertEquals(expectedSecond[i++],actual.get(key),tolerance);
        }
    }


    // Methods containing expected values

    private double[] getRawSignal() {
        return new double[] {9.08866E-06,-0.003358964,-0.00047346,-0.000634843,-0.014198154,0.018935373,0.000385076,
                0.000212049,-0.000245227,0.002245556,0.000875598,0.000259666,0.000752989,0.000623966,0.000370732,
                0.000171262,-0.001266233,-0.049795912,-0.019927391,-0.005781975,0.001158152,0.001056393,0.000368291,
                -0.000279306,0.001366934,0.003373914,0.065623868,0.00361389,0.000703747,0.001359659,-0.003417623,
                0.002205808,-0.000361372,0.000887567,0.000722851,-0.000382615,-5.9757E-05,-0.000298175,0.002078622,
                5.18042E-05,-5.07744E-06,0.000234077,-0.000131239,0.000331706,0.000316846,0.000425043,0.000367561,
                0.000326767,0.005849698,0.00028527,-0.002565558,0.000726813,0.000463877,-0.002205104,-0.036803777,
                -0.024027307,-0.010507997,-0.002398895,-0.000620699,0.002106218,0.001916785,0.002103288,-0.001333262,
                0.003715248,0.047066535,0.00806573,0.00069278,-0.001655841,-0.000976184,-0.000837856,-0.000362162,
                -0.000688287,0.002931158,0.00146094,-0.001220272,-0.007415105,-0.007616201,0.014201542,-0.003389809,
                0.003472647,-0.016956503,0.023952315,0.00028828,0.028116525,0.000521569,-0.000269907,-0.000210695,
                0.000283511,5.77515E-05,8.73221E-05,0.000671785,0.019992001,0.0193275,0.005837565,0.025017443,
                0.026611188,-0.006485216,-0.005405758,-0.002641749,-0.043570736,-0.022998638,0.000527986,-0.000227389,
                0.000315436,0.00068172,-0.000101177,0.00870277,0.000811455,0.013964643,-0.00372526,-0.002929251,
                -0.004138484,-0.001136284,0.040594507,0.018514541,-0.007036492,0.004030951,-0.001806889,-0.037234978,
                -0.000237927,0.000773875,0.001234043,0.000657928,0.000371599,-0.001870878,0.002061302,0.001443922,
                0.035807294,0.019462143,0.002713132,-0.004435029,0.015057286,0.000496056,0.013567922,-0.005070721,
                -0.000726067,-0.001409946,0.024861487,0.006192067,-0.003716795,0.002122956,-0.002015739,0.000777181,
                0.011124813,-0.002824769,-0.000172108,0.000379793,0.002977929,-0.000438202,0.00087026,-0.000459282,
                -0.000210258,-0.000267726,-0.00164692,0.004228754,0.000839623,-5.3768E-05,0.000914158,0.000161607,
                0.000597092,0.002427384,0.001211809,-0.000627721,-0.010145385,-0.02339921,0.003492419,0.026305852,
                0.03124058,0.002795434,0.000508869,-1.38766E-06,-0.002662499,0.000773102,0.00059843,0.000703446,
                -0.002885316,-0.010053635,0.009446682,0.000859241,4.03182E-05,-0.000155043,-7.75971E-05,1.67507E-06,
                -3.69886E-05,0.004634812,0.046779667,0.007023589,0.012428731,0.005110283,0.007820349,-0.000182768,
                0.000645219,0.000464748,-2.11461E-05,-0.000425888,-0.000134438,0.002018691,0.000574705,-0.000136469,
                0.000636577,-0.00026908,0.005699448,-0.010929704,0.002911625,-0.00394849,-0.005745189,0.037133144,
                0.042998063,0.001155188,0.000255714,0.001304376,-5.83442E-05,0.000230307,-1.21551E-05,0.000677594,
                -0.052743777,0.000475124,-0.000750252,0.000500765,-0.000109345,0.002120229,-0.000636274,-0.000574428,
                -0.000508208,-0.000247049,-0.000123061,-0.000190092,-0.000309956,-0.00017067,-0.002558635,0.001226558,
                7.77785E-05,-2.13045E-05,0.000114251,3.19797E-05,0.000173319,-0.000442138,2.82885E-05,0.000924395,
                -0.000621019,-2.71985E-05,0.000115689,-0.000190373,0.001626284,-0.001038014,0.00016618,-6.27749E-05,
                0.001143095,-0.001028638,0.001081847,3.60708E-05,0.002253276,0.002162969,0.001047469,0.001974843,
                -0.002657199,3.70671E-05,0.000302781,0.002419688,0.001712038,0.005363689,-0.004731802,-0.002495544,
                -0.001121612,0.003765053,0.028907688,0.00462131,0.001532235,-0.011547678,-0.019756123,-1.56272E-06,
                9.24191E-05,0.000266989,0.000426999,0.000249202,0.001700906,0.002163552,0.007432837,0.02507076,
                -0.005581734,0.040594404,0.000898803,0.005781126,-0.001686965,0.003257709,0.004449752,0.002088031,
                0.002607688,-0.002864551,0.000403497,1.7716E-05,-0.045123718,-0.007245998,-0.004950725,-0.001279615,
                -0.022601421,-0.019562836,-0.003017004,0.002286645,-0.001882921};
    }

    private double[] getPaddedSignal() {
        return new double[] {9.0886600E-06,-3.3589640E-03,-4.7346000E-04,-6.3484300E-04,-1.4198154E-02,1.8935373E-02,
                3.8507600E-04,2.1204900E-04,-2.4522700E-04,2.2455560E-03,8.7559800E-04,2.5966600E-04,7.5298900E-04,
                6.2396600E-04,3.7073200E-04,1.7126200E-04,-1.2662330E-03,-4.9795912E-02,-1.9927391E-02,-5.7819750E-03,
                1.1581520E-03,1.0563930E-03,3.6829100E-04,-2.7930600E-04,1.3669340E-03,3.3739140E-03,6.5623868E-02,
                3.6138900E-03,7.0374700E-04,1.3596590E-03,-3.4176230E-03,2.2058080E-03,-3.6137200E-04,8.8756700E-04,
                7.2285100E-04,-3.8261500E-04,-5.9757000E-05,-2.9817500E-04,2.0786220E-03,5.1804200E-05,-5.0774400E-06,
                2.3407700E-04,-1.3123900E-04,3.3170600E-04,3.1684600E-04,4.2504300E-04,3.6756100E-04,3.2676700E-04,
                5.8496980E-03,2.8527000E-04,-2.5655580E-03,7.2681300E-04,4.6387700E-04,-2.2051040E-03,-3.6803777E-02,
                -2.4027307E-02,-1.0507997E-02,-2.3988950E-03,-6.2069900E-04,2.1062180E-03,1.9167850E-03,2.1032880E-03,
                -1.3332620E-03,3.7152480E-03,4.7066535E-02,8.0657300E-03,6.9278000E-04,-1.6558410E-03,-9.7618400E-04,
                -8.3785600E-04,-3.6216200E-04,-6.8828700E-04,2.9311580E-03,1.4609400E-03,-1.2202720E-03,-7.4151050E-03,
                -7.6162010E-03,1.4201542E-02,-3.3898090E-03,3.4726470E-03,-1.6956503E-02,2.3952315E-02,2.8828000E-04,
                2.8116525E-02,5.2156900E-04,-2.6990700E-04,-2.1069500E-04,2.8351100E-04,5.7751500E-05,8.7322100E-05,
                6.7178500E-04,1.9992001E-02,1.9327500E-02,5.8375650E-03,2.5017443E-02,2.6611188E-02,-6.4852160E-03,
                -5.4057580E-03,-2.6417490E-03,-4.3570736E-02,-2.2998638E-02,5.2798600E-04,-2.2738900E-04,3.1543600E-04,
                6.8172000E-04,-1.0117700E-04,8.7027700E-03,8.1145500E-04,1.3964643E-02,-3.7252600E-03,-2.9292510E-03,
                -4.1384840E-03,-1.1362840E-03,4.0594507E-02,1.8514541E-02,-7.0364920E-03,4.0309510E-03,-1.8068890E-03,
                -3.7234978E-02,-2.3792700E-04,7.7387500E-04,1.2340430E-03,6.5792800E-04,3.7159900E-04,-1.8708780E-03,
                2.0613020E-03,1.4439220E-03,3.5807294E-02,1.9462143E-02,2.7131320E-03,-4.4350290E-03,1.5057286E-02,
                4.9605600E-04,1.3567922E-02,-5.0707210E-03,-7.2606700E-04,-1.4099460E-03,2.4861487E-02,6.1920670E-03,
                -3.7167950E-03,2.1229560E-03,-2.0157390E-03,7.7718100E-04,1.1124813E-02,-2.8247690E-03,-1.7210800E-04,
                3.7979300E-04,2.9779290E-03,-4.3820200E-04,8.7026000E-04,-4.5928200E-04,-2.1025800E-04,-2.6772600E-04,
                -1.6469200E-03,4.2287540E-03,8.3962300E-04,-5.3768000E-05,9.1415800E-04,1.6160700E-04,5.9709200E-04,
                2.4273840E-03,1.2118090E-03,-6.2772100E-04,-1.0145385E-02,-2.3399210E-02,3.4924190E-03,2.6305852E-02,
                3.1240580E-02,2.7954340E-03,5.0886900E-04,-1.3876600E-06,-2.6624990E-03,7.7310200E-04,5.9843000E-04,
                7.0344600E-04,-2.8853160E-03,-1.0053635E-02,9.4466820E-03,8.5924100E-04,4.0318200E-05,-1.5504300E-04,
                -7.7597100E-05,1.6750700E-06,-3.6988600E-05,4.6348120E-03,4.6779667E-02,7.0235890E-03,1.2428731E-02,
                5.1102830E-03,7.8203490E-03,-1.8276800E-04,6.4521900E-04,4.6474800E-04,-2.1146100E-05,-4.2588800E-04,
                -1.3443800E-04,2.0186910E-03,5.7470500E-04,-1.3646900E-04,6.3657700E-04,-2.6908000E-04,5.6994480E-03,
                -1.0929704E-02,2.9116250E-03,-3.9484900E-03,-5.7451890E-03,3.7133144E-02,4.2998063E-02,1.1551880E-03,
                2.5571400E-04,1.3043760E-03,-5.8344200E-05,2.3030700E-04,-1.2155100E-05,6.7759400E-04,-5.2743777E-02,
                4.7512400E-04,-7.5025200E-04,5.0076500E-04,-1.0934500E-04,2.1202290E-03,-6.3627400E-04,-5.7442800E-04,
                -5.0820800E-04,-2.4704900E-04,-1.2306100E-04,-1.9009200E-04,-3.0995600E-04,-1.7067000E-04,
                -2.5586350E-03,1.2265580E-03,7.7778500E-05,-2.1304500E-05,1.1425100E-04,3.1979700E-05,1.7331900E-04,
                -4.4213800E-04,2.8288500E-05,9.2439500E-04,-6.2101900E-04,-2.7198500E-05,1.1568900E-04,-1.9037300E-04,
                1.6262840E-03,-1.0380140E-03,1.6618000E-04,-6.2774900E-05,1.1430950E-03,-1.0286380E-03,1.0818470E-03,
                3.6070800E-05,2.2532760E-03,2.1629690E-03,1.0474690E-03,1.9748430E-03,-2.6571990E-03,3.7067100E-05,
                3.0278100E-04,2.4196880E-03,1.7120380E-03,5.3636890E-03,-4.7318020E-03,-2.4955440E-03,-1.1216120E-03,
                3.7650530E-03,2.8907688E-02,4.6213100E-03,1.5322350E-03,-1.1547678E-02,-1.9756123E-02,-1.5627200E-06,
                9.2419100E-05,2.6698900E-04,4.2699900E-04,2.4920200E-04,1.7009060E-03,2.1635520E-03,7.4328370E-03,
                2.5070760E-02,-5.5817340E-03,4.0594404E-02,8.9880300E-04,5.7811260E-03,-1.6869650E-03,3.2577090E-03,
                4.4497520E-03,2.0880310E-03,2.6076880E-03,-2.8645510E-03,4.0349700E-04,1.7716000E-05,-4.5123718E-02,
                -7.2459980E-03,-4.9507250E-03,-1.2796150E-03,-2.2601421E-02,-1.9562836E-02,-3.0170040E-03,2.2866450E-03,
                -1.8829210E-03,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
                0,0,0,0,0,0,0,0,0,0,0,0};
    }

    private Complex[] getFFT() {
        double[] real = new double[] {0.341671587610000,-0.060731188135627,-0.187235236206054,-0.014300683879802,
                0.012054154912759,-0.039103400771208,0.124412409706898,-0.148550992615881,0.145677180371705,
                -0.220587779192101,-0.248876591679045,0.099004031094903,-0.053129681293275,0.212719780452740,
                -0.121658559307295,0.239953588107467,0.101323840099647,0.138531618899951,0.191063956414370,
                -0.083602008259757,0.148684120584203,-0.399435853177046,0.362890480570671,0.106246336633073,
                0.204378990228531,0.070661271043152,-0.539631441603515,0.058435142892143,-0.174945080663125,
                -0.288178972410340,-0.292443400839262,-0.186500434924225,0.062974804529384,0.230340339702007,
                -0.080472065792170,-0.188228074882860,-0.194882856713928,0.130207648448571,-0.138344582115706,
                0.282030699694536,0.138186977306002,0.067749496221461,0.124830723373936,0.051872864759516,
                0.316170672514266,0.037774265765932,-0.129423978935780,-0.238237679219798,-0.128884304055130,
                0.290955923546564,0.123253128809651,-0.271847553829361,-0.030566113092250,-0.186633153176294,
                0.017329427419990,0.179753968233187,-0.083967270395064,-0.202244860068063,0.003388975618523,
                0.012755324218980,0.029703468413407,-0.004901740361655,-0.005297861610683,-0.048802638157992,
                0.212949031168690,-0.174891314573771,-0.179458988794907,-0.082781524787012,0.033498751380306,
                -0.144997183906936,0.025989576238283,0.085754332514273,0.179182177835418,0.050076290997562,
                -0.058119897261371,0.118847618621428,-0.128070648833827,0.415675797261661,-0.197207427547108,
                0.167479790160173,0.384075142587350,0.179263405553153,0.031640443317279,-0.210903309468319,
                -0.242341811017910,-0.018738443172041,0.050770101099976,-0.007315236121743,-0.395686495537804,
                0.284890443708942,-0.204940483359426,-0.166678373919617,-0.028969907020754,-0.161272917146009,
                0.074653120791135,-0.046708902499805,0.166362561183019,0.138559029589986,0.035534876294858,
                0.197513296032029,0.074687563950000,0.242140210924354,-0.010784304005851,-0.174530970442505,
                0.183322098457399,0.147170755859904,0.055360969040033,-0.144000932564542,0.142230296404395,
                -0.155557786339736,-0.051679330947815,0.002928278770239,0.038693235515563,0.020314568666985,
                -0.045009373137117,-0.144100194998534,-0.065091837978148,0.116586397310063,-0.022034885891486,
                0.162464205047805,0.095161954573478,-0.074600117589901,-0.058144157518620,-0.202950186655747,
                0.015795066089335,-0.166072167780681,0.004327054469443,0.106586576798199,-0.087114740470000,
                0.020761507609276,-0.094857023913804,-0.041479507625797,-0.030203820129764,0.021346865086188,
                -0.134168287145320,0.082116889501171,0.353169603750126,0.082506659121601,-0.016142341537765,
                0.014345574801840,-0.090088225571550,0.174256850079625,-0.017042442410813,-0.290422432847682,
                0.002387841707023,-0.031875678073478,0.047301129787015,-0.139922753450989,-0.266990831755069,
                -0.092933400564976,-0.173629464631865,-0.068117849603204,-0.054513169363543,0.061671489246797,
                0.044182050357714,-0.204740368843837,-0.021543660559209,0.123376409099463,0.161880402066706,
                0.076194509566812,-0.128466598321029,0.208085731818079,-0.061064323986297,0.139068168783268,
                -0.024090641673442,-0.223402987018317,0.095002063007096,-0.063060652612924,0.239704359428805,
                -0.139943616217151,-0.176375979342592,-0.100300332494749,0.106419569530584,0.059296499761743,
                -0.065608075164602,0.030400565178671,0.100154554951220,0.113777649496310,-0.036848290637299,
                0.048551596658408,0.036280938747250,-0.106179908844170,-0.057879726208036,-0.016526762647267,
                0.118237726716938,0.060403402218548,-0.044984656718105,-0.244569103956182,-0.107099670419829,
                0.091314223666679,-0.000333665487066,0.066621470811368,-0.040035261528690,0.137692671119229,
                0.303116641363421,-0.032366640979285,0.102813337485510,0.100112276843020,0.046758188521295,
                0.249500747878963,-0.044492035074690,0.177480729113902,-0.014052474440215,0.124807063949294,
                -0.148135113798850,0.026610160713076,-0.167885594843284,-0.098811809094346,0.066972660978870,
                -0.018106789422700,-0.064656850840055,-0.070077975046515,-0.046436530888576,-0.010237382296548,
                0.206665900010957,0.028518847945755,0.220066882122903,-0.048372879058124,0.044540435241229,
                0.043939188359111,0.007197230366179,0.084997917700824,0.019483464481609,0.130870309050858,
                -0.061840380591375,-0.035419893041409,-0.058355627066979,0.077840554107102,0.006489596829852,
                -0.175559859586427,0.099205575628458,-0.162910288935585,0.216499569119906,0.043396205548234,
                0.101463763637933,0.063293770119187,-0.049315044298956,-0.118893485486276,-0.054743591433787,
                -0.009131117805304,0.111289230295456,0.033124123439611,0.002814593179057,-0.217705895167606,
                -0.247894026442019,-0.120430499153670,0.015371386889132,0.112596437084227,-0.321802377380111,
                0.073189954722357,-0.154598215688636,0.030651682100979,0.021035239262435,-0.055003372368398,
                0.308135177353064,-0.067053422880690,-0.039073935390000,-0.067053422880690,0.308135177353064,
                -0.055003372368398,0.021035239262435,0.030651682100979,-0.154598215688636,0.073189954722357,
                -0.321802377380111,0.112596437084227,0.015371386889132,-0.120430499153670,-0.247894026442019,
                -0.217705895167606,0.002814593179057,0.033124123439611,0.111289230295456,-0.009131117805304,
                -0.054743591433787,-0.118893485486276,-0.049315044298956,0.063293770119187,0.101463763637933,
                0.043396205548234,0.216499569119906,-0.162910288935585,0.099205575628458,-0.175559859586427,
                0.006489596829852,0.077840554107102,-0.058355627066979,-0.035419893041409,-0.061840380591375,
                0.130870309050858,0.019483464481609,0.084997917700824,0.007197230366179,0.043939188359111,
                0.044540435241229,-0.048372879058124,0.220066882122903,0.028518847945755,0.206665900010957,
                -0.010237382296548,-0.046436530888576,-0.070077975046515,-0.064656850840055,-0.018106789422700,
                0.066972660978870,-0.098811809094346,-0.167885594843284,0.026610160713076,-0.148135113798850,
                0.124807063949294,-0.014052474440215,0.177480729113902,-0.044492035074690,0.249500747878963,
                0.046758188521295,0.100112276843020,0.102813337485510,-0.032366640979285,0.303116641363421,
                0.137692671119229,-0.040035261528690,0.066621470811368,-0.000333665487066,0.091314223666679,
                -0.107099670419829,-0.244569103956182,-0.044984656718105,0.060403402218548,0.118237726716938,
                -0.016526762647267,-0.057879726208036,-0.106179908844170,0.036280938747250,0.048551596658408,
                -0.036848290637299,0.113777649496310,0.100154554951220,0.030400565178671,-0.065608075164602,
                0.059296499761743,0.106419569530584,-0.100300332494749,-0.176375979342592,-0.139943616217151,
                0.239704359428805,-0.063060652612924,0.095002063007096,-0.223402987018317,-0.024090641673442,
                0.139068168783268,-0.061064323986297,0.208085731818079,-0.128466598321029,0.076194509566812,
                0.161880402066706,0.123376409099463,-0.021543660559209,-0.204740368843837,0.044182050357714,
                0.061671489246797,-0.054513169363543,-0.068117849603204,-0.173629464631865,-0.092933400564976,
                -0.266990831755069,-0.139922753450989,0.047301129787015,-0.031875678073478,0.002387841707023,
                -0.290422432847682,-0.017042442410813,0.174256850079625,-0.090088225571550,0.014345574801840,
                -0.016142341537765,0.082506659121601,0.353169603750126,0.082116889501171,-0.134168287145320,
                0.021346865086188,-0.030203820129764,-0.041479507625797,-0.094857023913804,0.020761507609276,
                -0.087114740470000,0.106586576798199,0.004327054469443,-0.166072167780681,0.015795066089335,
                -0.202950186655747,-0.058144157518620,-0.074600117589901,0.095161954573478,0.162464205047805,
                -0.022034885891486,0.116586397310063,-0.065091837978148,-0.144100194998534,-0.045009373137117,
                0.020314568666985,0.038693235515563,0.002928278770239,-0.051679330947815,-0.155557786339736,
                0.142230296404395,-0.144000932564542,0.055360969040033,0.147170755859904,0.183322098457399,
                -0.174530970442505,-0.010784304005851,0.242140210924354,0.074687563950000,0.197513296032029,
                0.035534876294858,0.138559029589986,0.166362561183019,-0.046708902499805,0.074653120791135,
                -0.161272917146009,-0.028969907020754,-0.166678373919617,-0.204940483359426,0.284890443708942,
                -0.395686495537804,-0.007315236121743,0.050770101099976,-0.018738443172041,-0.242341811017910,
                -0.210903309468319,0.031640443317279,0.179263405553153,0.384075142587350,0.167479790160173,
                -0.197207427547108,0.415675797261661,-0.128070648833827,0.118847618621428,-0.058119897261371,
                0.050076290997562,0.179182177835418,0.085754332514273,0.025989576238283,-0.144997183906936,
                0.033498751380306,-0.082781524787012,-0.179458988794907,-0.174891314573771,0.212949031168690,
                -0.048802638157992,-0.005297861610683,-0.004901740361655,0.029703468413407,0.012755324218980,
                0.003388975618523,-0.202244860068063,-0.083967270395064,0.179753968233187,0.017329427419990,
                -0.186633153176294,-0.030566113092250,-0.271847553829361,0.123253128809651,0.290955923546564,
                -0.128884304055130,-0.238237679219798,-0.129423978935780,0.037774265765932,0.316170672514266,
                0.051872864759516,0.124830723373936,0.067749496221461,0.138186977306002,0.282030699694536,
                -0.138344582115706,0.130207648448571,-0.194882856713928,-0.188228074882860,-0.080472065792170,
                0.230340339702007,0.062974804529384,-0.186500434924225,-0.292443400839262,-0.288178972410340,
                -0.174945080663125,0.058435142892143,-0.539631441603515,0.070661271043152,0.204378990228531,
                0.106246336633073,0.362890480570671,-0.399435853177046,0.148684120584203,-0.083602008259757,
                0.191063956414370,0.138531618899951,0.101323840099647,0.239953588107467,-0.121658559307295,
                0.212719780452740,-0.053129681293275,0.099004031094903,-0.248876591679045,-0.220587779192101,
                0.145677180371705,-0.148550992615881,0.124412409706898,-0.039103400771208,0.012054154912759,
                -0.014300683879802,-0.187235236206054,-0.060731188135627};

        double[] imag = new double[] {0,-0.334183074013405,0.101341858189454,0.022036514250875,0.028114027453100,
                0.091692296610167,-0.138996956722668,0.121786565496718,-0.182773097222480,-0.029207293173475,
                0.075587250218175,0.274003565648444,0.090652962545355,0.021165198846333,0.163567896379744,
                -0.002901119872377,0.140872306288068,-0.167964494025885,-0.006102737192787,-0.181999301051914,
                -0.166620298962176,0.089898317750155,0.137268319667867,-0.058339314664814,-0.283368048353279,
                -0.337192123328132,-0.340988650268930,0.286542104342137,-0.380541529000998,0.035027349527201,
                0.101796512872859,0.203777300303292,0.386875393429100,-0.099532445733551,-0.076487164239942,
                -0.057052134044420,0.281866178123297,0.129433594915404,0.172924184866517,0.254334169919230,
                -0.059148569320076,0.000409281356371,0.063474065846232,-0.054033124884770,0.073139942777667,
                -0.456812564881999,-0.068162633212078,-0.129344904362665,0.278462477144732,0.137470254356377,
                -0.380037446283640,-0.040081636238568,-0.019132836698164,0.041477033224227,0.201866799793473,
                -0.052504615212259,-0.171897921711453,0.034886087585816,0.165737103770719,0.000432089908375,
                0.058407483172788,-0.020922200079436,-0.004144197036758,0.106503938425777,-0.073586742841965,
                -0.181088269213228,0.020607780929473,0.233296698224358,-0.078982190046128,0.231964041682934,
                0.040339646316733,0.317032656671468,-0.112183837334330,0.043420445042323,-0.011843742395112,
                0.047892748851732,0.155685384805918,0.031026604921558,-0.138303008883672,0.301688153550462,
                -0.059446318715269,-0.304176506988842,-0.289095693328464,-0.271109035426189,0.032181445727259,
                0.100126668575618,-0.006590053561579,-0.253120231398313,0.147458876744769,0.096881583745479,
                -0.204677799202452,0.101847613188482,0.135651849408354,0.034928046758908,0.287364868661049,
                0.024684764614641,0.276052966140817,-0.055263631453138,0.079779185371913,0.063322977354556,
                -0.051671199272571,-0.017655001753347,-0.275202093587610,0.033604570385622,0.200828829495022,
                -0.228571725116586,-0.081726054013500,-0.135279306217288,0.014836851226882,-0.173677403113088,
                0.019164150032725,0.117766623949585,-0.168304058995043,0.101782534429479,-0.255533080767258,
                0.087188059036888,0.102465384203330,0.009049947171460,0.090349267288109,-0.073971548100079,
                -0.064275456278416,-0.241507813716641,-0.047681252337392,-0.022904910348868,-0.000658802541679,
                0.065607060601913,0.060063476794222,0.085585109577550,-0.165278965100000,0.111355862683144,
                -0.089254266986576,0.065928253204722,0.108374585461976,-0.073068343799843,0.167299529430064,
                0.198958804343746,0.076481561169644,-0.273133695301316,-0.064914770498393,-0.083556666227442,
                -0.058783811736691,0.066809733261389,-0.397837366547354,0.018968421998447,0.072696842220320,
                -0.061723705473865,-0.011261381122971,-0.281871568244584,0.095493746296478,0.027717342049661,
                0.069407292896624,0.185469078445436,0.051351624477974,0.236233801465078,-0.175578649767074,
                0.139343359634601,0.187727517850795,0.175713037409513,0.063386439503576,-0.184484727661084,
                0.173140767407891,-0.054365948064660,0.035441944028094,-0.052033334438925,-0.143611312572807,
                0.018319919878350,0.138862480769019,0.029758198781487,0.006350589524091,-0.226521360245863,
                0.034183739681041,0.218625249457376,0.071230500152468,0.043820761287580,-0.048560997403503,
                0.191987052568370,0.008623436227849,-0.020944011365074,-0.054540821801440,0.023469653140091,
                -0.068108419677515,-0.073097409088342,0.095205184464824,0.079944185748366,0.055436239016682,
                -0.068335773266274,-0.171720192055451,0.039060098795718,0.185923915108363,0.186853359894903,
                0.019034422489152,0.137775163030150,0.041208333938035,0.299207872874162,-0.091224818067994,
                -0.055941178377146,0.061824569663664,-0.018528058287349,0.022803858227021,-0.012028848720050,
                -0.171726156480858,0.037817362525423,-0.174361895937494,-0.113313160750351,-0.115044689928023,
                -0.121407640652079,0.013134981632297,-0.049245480196488,0.235325562079206,-0.264245191989253,
                0.179735968575654,-0.093818998709350,0.148905631900233,0.180330732794838,0.000624951176597,
                0.120050494583746,-0.161506200733564,0.003116446847763,-0.078360176615342,0.027328429925310,
                -0.041024427478529,-0.030269835410753,0.022055354341965,-0.165846268040559,-0.041171329303827,
                -0.141372286558568,0.100536905983236,-0.055237633164185,-0.126312322243463,0.029655571488339,
                0.002500772805676,0.059902691711039,0.111640532634626,-0.102836090296964,-0.029908853361461,
                -0.147719326619084,-0.170580695926269,-0.031089234278674,-0.024851390375885,0.102454762270764,
                -0.108842626025213,-0.035897999561872,-0.304362493673015,-0.082059514782452,-0.057878937357257,
                0.189036354645008,0.126635333227445,-0.176241572209566,0.068144203302925,0.038539355284234,
                0.127747869076033,0.041754895300389,0.130164833562852,0.066379368566967,0.114019073446887,
                -0.224349152849584,0,0.224349152849584,-0.114019073446887,-0.066379368566967,-0.130164833562852,
                -0.041754895300389,-0.127747869076033,-0.038539355284234,-0.068144203302925,0.176241572209566,
                -0.126635333227445,-0.189036354645008,0.057878937357257,0.082059514782452,0.304362493673015,
                0.035897999561872,0.108842626025213,-0.102454762270764,0.024851390375885,0.031089234278674,
                0.170580695926269,0.147719326619084,0.029908853361461,0.102836090296964,-0.111640532634626,
                -0.059902691711039,-0.002500772805676,-0.029655571488339,0.126312322243463,0.055237633164185,
                -0.100536905983236,0.141372286558568,0.041171329303827,0.165846268040559,-0.022055354341965,
                0.030269835410753,0.041024427478529,-0.027328429925310,0.078360176615342,-0.003116446847763,
                0.161506200733564,-0.120050494583746,-0.000624951176597,-0.180330732794838,-0.148905631900233,
                0.093818998709350,-0.179735968575654,0.264245191989253,-0.235325562079206,0.049245480196488,
                -0.013134981632297,0.121407640652079,0.115044689928023,0.113313160750351,0.174361895937494,
                -0.037817362525423,0.171726156480858,0.012028848720050,-0.022803858227021,0.018528058287349,
                -0.061824569663664,0.055941178377146,0.091224818067994,-0.299207872874162,-0.041208333938035,
                -0.137775163030150,-0.019034422489152,-0.186853359894903,-0.185923915108363,-0.039060098795718,
                0.171720192055451,0.068335773266274,-0.055436239016682,-0.079944185748366,-0.095205184464824,
                0.073097409088342,0.068108419677515,-0.023469653140091,0.054540821801440,0.020944011365074,
                -0.008623436227849,-0.191987052568370,0.048560997403503,-0.043820761287580,-0.071230500152468,
                -0.218625249457376,-0.034183739681041,0.226521360245863,-0.006350589524091,-0.029758198781487,
                -0.138862480769019,-0.018319919878350,0.143611312572807,0.052033334438925,-0.035441944028094,
                0.054365948064660,-0.173140767407891,0.184484727661084,-0.063386439503576,-0.175713037409513,
                -0.187727517850795,-0.139343359634601,0.175578649767074,-0.236233801465078,-0.051351624477974,
                -0.185469078445436,-0.069407292896624,-0.027717342049661,-0.095493746296478,0.281871568244584,
                0.011261381122971,0.061723705473865,-0.072696842220320,-0.018968421998447,0.397837366547354,
                -0.066809733261389,0.058783811736691,0.083556666227442,0.064914770498393,0.273133695301316,
                -0.076481561169644,-0.198958804343746,-0.167299529430064,0.073068343799843,-0.108374585461976,
                -0.065928253204722,0.089254266986576,-0.111355862683144,0.165278965100000,-0.085585109577550,
                -0.060063476794222,-0.065607060601913,0.000658802541679,0.022904910348868,0.047681252337392,
                0.241507813716641,0.064275456278416,0.073971548100079,-0.090349267288109,-0.009049947171460,
                -0.102465384203330,-0.087188059036888,0.255533080767258,-0.101782534429479,0.168304058995043,
                -0.117766623949585,-0.019164150032725,0.173677403113088,-0.014836851226882,0.135279306217288,
                0.081726054013500,0.228571725116586,-0.200828829495022,-0.033604570385622,0.275202093587610,
                0.017655001753347,0.051671199272571,-0.063322977354556,-0.079779185371913,0.055263631453138,
                -0.276052966140817,-0.024684764614641,-0.287364868661049,-0.034928046758908,-0.135651849408354,
                -0.101847613188482,0.204677799202452,-0.096881583745479,-0.147458876744769,0.253120231398313,
                0.006590053561579,-0.100126668575618,-0.032181445727259,0.271109035426189,0.289095693328464,
                0.304176506988842,0.059446318715269,-0.301688153550462,0.138303008883672,-0.031026604921558,
                -0.155685384805918,-0.047892748851732,0.011843742395112,-0.043420445042323,0.112183837334330,
                -0.317032656671468,-0.040339646316733,-0.231964041682934,0.078982190046128,-0.233296698224358,
                -0.020607780929473,0.181088269213228,0.073586742841965,-0.106503938425777,0.004144197036758,
                0.020922200079436,-0.058407483172788,-0.000432089908375,-0.165737103770719,-0.034886087585816,
                0.171897921711453,0.052504615212259,-0.201866799793473,-0.041477033224227,0.019132836698164,
                0.040081636238568,0.380037446283640,-0.137470254356377,-0.278462477144732,0.129344904362665,
                0.068162633212078,0.456812564881999,-0.073139942777667,0.054033124884770,-0.063474065846232,
                -0.000409281356371,0.059148569320076,-0.254334169919230,-0.172924184866517,-0.129433594915404,
                -0.281866178123297,0.057052134044420,0.076487164239942,0.099532445733551,-0.386875393429100,
                -0.203777300303292,-0.101796512872859,-0.035027349527201,0.380541529000998,-0.286542104342137,
                0.340988650268930,0.337192123328132,0.283368048353279,0.058339314664814,-0.137268319667867,
                -0.089898317750155,0.166620298962176,0.181999301051914,0.006102737192787,0.167964494025885,
                -0.140872306288068,0.002901119872377,-0.163567896379744,-0.021165198846333,-0.090652962545355,
                -0.274003565648444,-0.075587250218175,0.029207293173475,0.182773097222480,-0.121786565496718,
                0.138996956722668,-0.091692296610167,-0.028114027453100,-0.022036514250875,-0.101341858189454,
                0.334183074013405};

        Complex[] complex = new Complex[512];

        for (int i=0;i<512;i++) {
            complex[i] = new Complex(real[i],imag[i]);
        }

        return complex;

    }

    private double[] getPSD() {
        return new double[] {0.000228006784726,0.000450650797537,0.000177059398041,0.000002695771562,0.000003655082775,
                0.000038814660975,0.000135932037763,0.000144138144307,0.000213390023240,0.000193406383998,
                0.000264269493286,0.000331561531879,0.000043127822862,0.000178506525930,0.000162325241324,
                0.000224945863055,0.000117623153326,0.000185168283939,0.000142744839226,0.000156691567846,
                0.000194801920860,0.000654807454444,0.000588015986224,0.000057389686264,0.000476828994041,
                0.000463638840859,0.001591700595232,0.000334066576116,0.000685225142745,0.000329195450603,
                0.000374553409092,0.000298076563851,0.000600149984556,0.000245950702530,0.000048148592447,
                0.000151112320989,0.000458702618011,0.000131668309403,0.000191570301221,0.000563387443589,
                0.000088258570116,0.000017930319334,0.000076608072395,0.000021915518294,0.000411380255420,
                0.000820721150735,0.000083580901914,0.000287059750331,0.000367783261755,0.000404505547967,
                0.000623514821637,0.000294951680026,0.000005079502772,0.000142782336522,0.000160353569975,
                0.000136985248883,0.000142966398384,0.000164531338012,0.000107344815321,0.000000636269522,
                0.000016772383306,0.000001803771542,0.000000176725417,0.000053612446841,0.000198290228898,
                0.000247577863906,0.000127461755055,0.000239375508783,0.000028751377690,0.000292310546777,
                0.000008995098195,0.000421341839614,0.000174576039894,0.000017160038937,0.000013742955827,
                0.000064134655643,0.000158750117714,0.000678707104071,0.000226634733383,0.000465098523847,
                0.000590029609228,0.000486948109275,0.000330380615447,0.000460860605603,0.000233457807877,
                0.000040533121143,0.000010238406139,0.000250481891495,0.000696530949538,0.000353705492913,
                0.000327709387523,0.000149041471268,0.000075158905315,0.000106362977559,0.000344342406970,
                0.000010902574909,0.000405788054213,0.000086924506415,0.000029794710359,0.000168051959260,
                0.000032219316574,0.000230248362630,0.000296298802843,0.000123399714041,0.000288825041169,
                0.000288688534778,0.000038062440616,0.000152487340899,0.000079881208475,0.000212351817356,
                0.000011867257397,0.000054209189582,0.000116497745113,0.000042079554746,0.000262980464987,
                0.000110807124364,0.000057562899732,0.000053415193678,0.000033783305843,0.000124478155665,
                0.000051512233899,0.000249575006370,0.000022086894055,0.000162943020241,0.000000976242709,
                0.000124547856688,0.000014165408769,0.000072990270840,0.000136352009030,0.000050121751375,
                0.000066266324848,0.000023699547357,0.000049442662205,0.000022635435604,0.000179649460246,
                0.000180967927216,0.000510071086765,0.000318005329330,0.000017478525856,0.000028076218701,
                0.000045200878550,0.000136050743196,0.000619394590096,0.000330878869275,0.000020666143191,
                0.000018851072930,0.000009235217125,0.000386835773117,0.000314074843059,0.000036737765589,
                0.000136580325373,0.000152495392555,0.000021908886604,0.000232850709143,0.000128046546203,
                0.000239590587924,0.000139475586987,0.000180065663430,0.000118059005024,0.000155625851673,
                0.000181567938370,0.000180684875372,0.000019472590080,0.000086122747897,0.000082830344200,
                0.000196267633098,0.000110578830238,0.000018992954307,0.000224603554361,0.000276938056123,
                0.000126082086514,0.000226004517183,0.000064058238012,0.000021235679702,0.000026025742170,
                0.000147590713739,0.000039473822382,0.000052281270066,0.000016923819397,0.000011359695924,
                0.000023261966201,0.000064911735381,0.000048492538496,0.000026032057494,0.000066614596154,
                0.000032493550420,0.000123091576952,0.000239608351281,0.000179836100052,0.000168954943546,
                0.000001415705360,0.000091485999692,0.000012894331842,0.000423768058085,0.000391412756652,
                0.000016316464400,0.000056222108512,0.000040491237963,0.000010571656812,0.000243731704663,
                0.000122927398456,0.000128631102012,0.000119529464034,0.000111002639105,0.000137419111800,
                0.000060343421335,0.000110773830853,0.000047612855220,0.000233841630807,0.000274036630127,
                0.000142521588908,0.000053566121506,0.000095036088330,0.000127437410885,0.000166840565591,
                0.000059474398195,0.000291069083917,0.000009178311208,0.000031735029885,0.000010458966234,
                0.000006776577246,0.000031800425583,0.000003382984544,0.000174343837555,0.000021559808704,
                0.000082971454023,0.000052785346387,0.000035587296802,0.000062487959444,0.000123830926634,
                0.000038468750392,0.000117687869982,0.000231779968578,0.000048665984858,0.000043708729848,
                0.000100887112471,0.000123163075847,0.000058992974137,0.000014118954714,0.000041329514158,
                0.000094656289140,0.000009319820024,0.000361892380819,0.000211443831082,0.000253130545841,
                0.000196243158218,0.000063565574830,0.000170855661793,0.000422657822388,0.000026726763195,
                0.000157109868545,0.000010480456630,0.000067911582763,0.000029029654466,0.000421670455594,
                0.000214174624626,0.000002981977396};
    }

    private double[] getFrequency() {
        return new double[] {0,0.001953125000000,0.003906250000000,0.005859375000000,0.007812500000000,
                0.009765625000000,0.011718750000000,0.013671875000000,0.015625000000000,0.017578125000000,
                0.019531250000000,0.021484375000000,0.023437500000000,0.025390625000000,0.027343750000000,
                0.029296875000000,0.031250000000000,0.033203125000000,0.035156250000000,0.037109375000000,
                0.039062500000000,0.041015625000000,0.042968750000000,0.044921875000000,0.046875000000000,
                0.048828125000000,0.050781250000000,0.052734375000000,0.054687500000000,0.056640625000000,
                0.058593750000000,0.060546875000000,0.062500000000000,0.064453125000000,0.066406250000000,
                0.068359375000000,0.070312500000000,0.072265625000000,0.074218750000000,0.076171875000000,
                0.078125000000000,0.080078125000000,0.082031250000000,0.083984375000000,0.085937500000000,
                0.087890625000000,0.089843750000000,0.091796875000000,0.093750000000000,0.095703125000000,
                0.097656250000000,0.099609375000000,0.101562500000000,0.103515625000000,0.105468750000000,
                0.107421875000000,0.109375000000000,0.111328125000000,0.113281250000000,0.115234375000000,
                0.117187500000000,0.119140625000000,0.121093750000000,0.123046875000000,0.125000000000000,
                0.126953125000000,0.128906250000000,0.130859375000000,0.132812500000000,0.134765625000000,
                0.136718750000000,0.138671875000000,0.140625000000000,0.142578125000000,0.144531250000000,
                0.146484375000000,0.148437500000000,0.150390625000000,0.152343750000000,0.154296875000000,
                0.156250000000000,0.158203125000000,0.160156250000000,0.162109375000000,0.164062500000000,
                0.166015625000000,0.167968750000000,0.169921875000000,0.171875000000000,0.173828125000000,
                0.175781250000000,0.177734375000000,0.179687500000000,0.181640625000000,0.183593750000000,
                0.185546875000000,0.187500000000000,0.189453125000000,0.191406250000000,0.193359375000000,
                0.195312500000000,0.197265625000000,0.199218750000000,0.201171875000000,0.203125000000000,
                0.205078125000000,0.207031250000000,0.208984375000000,0.210937500000000,0.212890625000000,
                0.214843750000000,0.216796875000000,0.218750000000000,0.220703125000000,0.222656250000000,
                0.224609375000000,0.226562500000000,0.228515625000000,0.230468750000000,0.232421875000000,
                0.234375000000000,0.236328125000000,0.238281250000000,0.240234375000000,0.242187500000000,
                0.244140625000000,0.246093750000000,0.248046875000000,0.250000000000000,0.251953125000000,
                0.253906250000000,0.255859375000000,0.257812500000000,0.259765625000000,0.261718750000000,
                0.263671875000000,0.265625000000000,0.267578125000000,0.269531250000000,0.271484375000000,
                0.273437500000000,0.275390625000000,0.277343750000000,0.279296875000000,0.281250000000000,
                0.283203125000000,0.285156250000000,0.287109375000000,0.289062500000000,0.291015625000000,
                0.292968750000000,0.294921875000000,0.296875000000000,0.298828125000000,0.300781250000000,
                0.302734375000000,0.304687500000000,0.306640625000000,0.308593750000000,0.310546875000000,
                0.312500000000000,0.314453125000000,0.316406250000000,0.318359375000000,0.320312500000000,
                0.322265625000000,0.324218750000000,0.326171875000000,0.328125000000000,0.330078125000000,
                0.332031250000000,0.333984375000000,0.335937500000000,0.337890625000000,0.339843750000000,
                0.341796875000000,0.343750000000000,0.345703125000000,0.347656250000000,0.349609375000000,
                0.351562500000000,0.353515625000000,0.355468750000000,0.357421875000000,0.359375000000000,
                0.361328125000000,0.363281250000000,0.365234375000000,0.367187500000000,0.369140625000000,
                0.371093750000000,0.373046875000000,0.375000000000000,0.376953125000000,0.378906250000000,
                0.380859375000000,0.382812500000000,0.384765625000000,0.386718750000000,0.388671875000000,
                0.390625000000000,0.392578125000000,0.394531250000000,0.396484375000000,0.398437500000000,
                0.400390625000000,0.402343750000000,0.404296875000000,0.406250000000000,0.408203125000000,
                0.410156250000000,0.412109375000000,0.414062500000000,0.416015625000000,0.417968750000000,
                0.419921875000000,0.421875000000000,0.423828125000000,0.425781250000000,0.427734375000000,
                0.429687500000000,0.431640625000000,0.433593750000000,0.435546875000000,0.437500000000000,
                0.439453125000000,0.441406250000000,0.443359375000000,0.445312500000000,0.447265625000000,
                0.449218750000000,0.451171875000000,0.453125000000000,0.455078125000000,0.457031250000000,
                0.458984375000000,0.460937500000000,0.462890625000000,0.464843750000000,0.466796875000000,
                0.468750000000000,0.470703125000000,0.472656250000000,0.474609375000000,0.476562500000000,
                0.478515625000000,0.480468750000000,0.482421875000000,0.484375000000000,0.486328125000000,
                0.488281250000000,0.490234375000000,0.492187500000000,0.494140625000000,0.496093750000000,
                0.498046875000000,0.500000000000000};
    }

    private TreeMap<Double,Double> getPeriodogram() {
        double[] freq = getFrequency();
        double[] psd = getPSD();

        TreeMap<Double,Double> periodogram = new TreeMap<>();
        for (int i=0;i<freq.length;i++) {
            periodogram.put(freq[i],psd[i]);
        }

        return periodogram;

    }

    private double[] getFirstFlattenedPSD() {
        return new double[]{0.000228006784726, 0.000450650797537, 0.000177059398041, 0.000002695771562, 0.000003655082775,
                0.000038814660975, 0.000135932037763, 0.000144138144307, 0.000213390023240, 0.000193406383998,
                0.000264269493286, 0.000331561531879, 0.000043127822862, 0.000178506525930, 0.000162325241324,
                0.000224945863055, 0.000117623153326, 0.000185168283939, 0.000142744839226, 0.000156691567846,
                0.000194801920860, 0.000654807454444, 0.000588015986224, 0.000057389686264, 0.000476828994041,
                -Double.MAX_VALUE, -Double.MAX_VALUE, -Double.MAX_VALUE, 0.000685225142745, 0.000329195450603,
                0.000374553409092, 0.000298076563851, 0.000600149984556, 0.000245950702530, 0.000048148592447,
                0.000151112320989, 0.000458702618011, 0.000131668309403, 0.000191570301221, 0.000563387443589,
                0.000088258570116, 0.000017930319334, 0.000076608072395, 0.000021915518294, 0.000411380255420,
                0.000820721150735, 0.000083580901914, 0.000287059750331, 0.000367783261755, 0.000404505547967,
                0.000623514821637, 0.000294951680026, 0.000005079502772, 0.000142782336522, 0.000160353569975,
                0.000136985248883, 0.000142966398384, 0.000164531338012, 0.000107344815321, 0.000000636269522,
                0.000016772383306, 0.000001803771542, 0.000000176725417, 0.000053612446841, 0.000198290228898,
                0.000247577863906, 0.000127461755055, 0.000239375508783, 0.000028751377690, 0.000292310546777,
                0.000008995098195, 0.000421341839614, 0.000174576039894, 0.000017160038937, 0.000013742955827,
                0.000064134655643, 0.000158750117714, 0.000678707104071, 0.000226634733383, 0.000465098523847,
                0.000590029609228, 0.000486948109275, 0.000330380615447, 0.000460860605603, 0.000233457807877,
                0.000040533121143, 0.000010238406139, 0.000250481891495, 0.000696530949538, 0.000353705492913,
                0.000327709387523, 0.000149041471268, 0.000075158905315, 0.000106362977559, 0.000344342406970,
                0.000010902574909, 0.000405788054213, 0.000086924506415, 0.000029794710359, 0.000168051959260,
                0.000032219316574, 0.000230248362630, 0.000296298802843, 0.000123399714041, 0.000288825041169,
                0.000288688534778, 0.000038062440616, 0.000152487340899, 0.000079881208475, 0.000212351817356,
                0.000011867257397, 0.000054209189582, 0.000116497745113, 0.000042079554746, 0.000262980464987,
                0.000110807124364, 0.000057562899732, 0.000053415193678, 0.000033783305843, 0.000124478155665,
                0.000051512233899, 0.000249575006370, 0.000022086894055, 0.000162943020241, 0.000000976242709,
                0.000124547856688, 0.000014165408769, 0.000072990270840, 0.000136352009030, 0.000050121751375,
                0.000066266324848, 0.000023699547357, 0.000049442662205, 0.000022635435604, 0.000179649460246,
                0.000180967927216, 0.000510071086765, 0.000318005329330, 0.000017478525856, 0.000028076218701,
                0.000045200878550, 0.000136050743196, 0.000619394590096, 0.000330878869275, 0.000020666143191,
                0.000018851072930, 0.000009235217125, 0.000386835773117, 0.000314074843059, 0.000036737765589,
                0.000136580325373, 0.000152495392555, 0.000021908886604, 0.000232850709143, 0.000128046546203,
                0.000239590587924, 0.000139475586987, 0.000180065663430, 0.000118059005024, 0.000155625851673,
                0.000181567938370, 0.000180684875372, 0.000019472590080, 0.000086122747897, 0.000082830344200,
                0.000196267633098, 0.000110578830238, 0.000018992954307, 0.000224603554361, 0.000276938056123,
                0.000126082086514, 0.000226004517183, 0.000064058238012, 0.000021235679702, 0.000026025742170,
                0.000147590713739, 0.000039473822382, 0.000052281270066, 0.000016923819397, 0.000011359695924,
                0.000023261966201, 0.000064911735381, 0.000048492538496, 0.000026032057494, 0.000066614596154,
                0.000032493550420, 0.000123091576952, 0.000239608351281, 0.000179836100052, 0.000168954943546,
                0.000001415705360, 0.000091485999692, 0.000012894331842, 0.000423768058085, 0.000391412756652,
                0.000016316464400, 0.000056222108512, 0.000040491237963, 0.000010571656812, 0.000243731704663,
                0.000122927398456, 0.000128631102012, 0.000119529464034, 0.000111002639105, 0.000137419111800,
                0.000060343421335, 0.000110773830853, 0.000047612855220, 0.000233841630807, 0.000274036630127,
                0.000142521588908, 0.000053566121506, 0.000095036088330, 0.000127437410885, 0.000166840565591,
                0.000059474398195, 0.000291069083917, 0.000009178311208, 0.000031735029885, 0.000010458966234,
                0.000006776577246, 0.000031800425583, 0.000003382984544, 0.000174343837555, 0.000021559808704,
                0.000082971454023, 0.000052785346387, 0.000035587296802, 0.000062487959444, 0.000123830926634,
                0.000038468750392, 0.000117687869982, 0.000231779968578, 0.000048665984858, 0.000043708729848,
                0.000100887112471, 0.000123163075847, 0.000058992974137, 0.000014118954714, 0.000041329514158,
                0.000094656289140, 0.000009319820024, 0.000361892380819, 0.000211443831082, 0.000253130545841,
                0.000196243158218, 0.000063565574830, 0.000170855661793, 0.000422657822388, 0.000026726763195,
                0.000157109868545, 0.000010480456630, 0.000067911582763, 0.000029029654466, 0.000421670455594,
                0.000214174624626, 0.000002981977396};
    }

    private double[] getSecondFlattenedPSD() {
        return new double[]{0.000228006784726, 0.000450650797537, 0.000177059398041, 0.000002695771562, 0.000003655082775,
                0.000038814660975, 0.000135932037763, 0.000144138144307, 0.000213390023240, 0.000193406383998,
                0.000264269493286, 0.000331561531879, 0.000043127822862, 0.000178506525930, 0.000162325241324,
                0.000224945863055, 0.000117623153326, 0.000185168283939, 0.000142744839226, 0.000156691567846,
                0.000194801920860, 0.000654807454444, 0.000588015986224, 0.000057389686264, 0.000476828994041,
                -Double.MAX_VALUE, -Double.MAX_VALUE, -Double.MAX_VALUE, 0.000685225142745, 0.000329195450603,
                0.000374553409092, 0.000298076563851, 0.000600149984556, 0.000245950702530, 0.000048148592447,
                0.000151112320989, 0.000458702618011, 0.000131668309403, 0.000191570301221, 0.000563387443589,
                0.000088258570116, 0.000017930319334, 0.000076608072395, -Double.MAX_VALUE, -Double.MAX_VALUE,
                -Double.MAX_VALUE, -Double.MAX_VALUE, 0.000287059750331, 0.000367783261755, 0.000404505547967,
                0.000623514821637, 0.000294951680026, 0.000005079502772, 0.000142782336522, 0.000160353569975,
                0.000136985248883, 0.000142966398384, 0.000164531338012, 0.000107344815321, 0.000000636269522,
                0.000016772383306, 0.000001803771542, 0.000000176725417, 0.000053612446841, 0.000198290228898,
                0.000247577863906, 0.000127461755055, 0.000239375508783, 0.000028751377690, 0.000292310546777,
                0.000008995098195, 0.000421341839614, 0.000174576039894, 0.000017160038937, 0.000013742955827,
                0.000064134655643, 0.000158750117714, 0.000678707104071, 0.000226634733383, 0.000465098523847,
                0.000590029609228, 0.000486948109275, 0.000330380615447, 0.000460860605603, 0.000233457807877,
                0.000040533121143, 0.000010238406139, 0.000250481891495, 0.000696530949538, 0.000353705492913,
                0.000327709387523, 0.000149041471268, 0.000075158905315, 0.000106362977559, 0.000344342406970,
                0.000010902574909, 0.000405788054213, 0.000086924506415, 0.000029794710359, 0.000168051959260,
                0.000032219316574, 0.000230248362630, 0.000296298802843, 0.000123399714041, 0.000288825041169,
                0.000288688534778, 0.000038062440616, 0.000152487340899, 0.000079881208475, 0.000212351817356,
                0.000011867257397, 0.000054209189582, 0.000116497745113, 0.000042079554746, 0.000262980464987,
                0.000110807124364, 0.000057562899732, 0.000053415193678, 0.000033783305843, 0.000124478155665,
                0.000051512233899, 0.000249575006370, 0.000022086894055, 0.000162943020241, 0.000000976242709,
                0.000124547856688, 0.000014165408769, 0.000072990270840, 0.000136352009030, 0.000050121751375,
                0.000066266324848, 0.000023699547357, 0.000049442662205, 0.000022635435604, 0.000179649460246,
                0.000180967927216, 0.000510071086765, 0.000318005329330, 0.000017478525856, 0.000028076218701,
                0.000045200878550, 0.000136050743196, 0.000619394590096, 0.000330878869275, 0.000020666143191,
                0.000018851072930, 0.000009235217125, 0.000386835773117, 0.000314074843059, 0.000036737765589,
                0.000136580325373, 0.000152495392555, 0.000021908886604, 0.000232850709143, 0.000128046546203,
                0.000239590587924, 0.000139475586987, 0.000180065663430, 0.000118059005024, 0.000155625851673,
                0.000181567938370, 0.000180684875372, 0.000019472590080, 0.000086122747897, 0.000082830344200,
                0.000196267633098, 0.000110578830238, 0.000018992954307, 0.000224603554361, 0.000276938056123,
                0.000126082086514, 0.000226004517183, 0.000064058238012, 0.000021235679702, 0.000026025742170,
                0.000147590713739, 0.000039473822382, 0.000052281270066, 0.000016923819397, 0.000011359695924,
                0.000023261966201, 0.000064911735381, 0.000048492538496, 0.000026032057494, 0.000066614596154,
                0.000032493550420, 0.000123091576952, 0.000239608351281, 0.000179836100052, 0.000168954943546,
                0.000001415705360, 0.000091485999692, 0.000012894331842, 0.000423768058085, 0.000391412756652,
                0.000016316464400, 0.000056222108512, 0.000040491237963, 0.000010571656812, 0.000243731704663,
                0.000122927398456, 0.000128631102012, 0.000119529464034, 0.000111002639105, 0.000137419111800,
                0.000060343421335, 0.000110773830853, 0.000047612855220, 0.000233841630807, 0.000274036630127,
                0.000142521588908, 0.000053566121506, 0.000095036088330, 0.000127437410885, 0.000166840565591,
                0.000059474398195, 0.000291069083917, 0.000009178311208, 0.000031735029885, 0.000010458966234,
                0.000006776577246, 0.000031800425583, 0.000003382984544, 0.000174343837555, 0.000021559808704,
                0.000082971454023, 0.000052785346387, 0.000035587296802, 0.000062487959444, 0.000123830926634,
                0.000038468750392, 0.000117687869982, 0.000231779968578, 0.000048665984858, 0.000043708729848,
                0.000100887112471, 0.000123163075847, 0.000058992974137, 0.000014118954714, 0.000041329514158,
                0.000094656289140, 0.000009319820024, 0.000361892380819, 0.000211443831082, 0.000253130545841,
                0.000196243158218, 0.000063565574830, 0.000170855661793, 0.000422657822388, 0.000026726763195,
                0.000157109868545, 0.000010480456630, 0.000067911582763, 0.000029029654466, 0.000421670455594,
                0.000214174624626, 0.000002981977396};
    }

    private double[][] getKeyFrequencies() {
        return new double[][]{
                {0.050781250000000,0.001591700595232},
                {0.087890625000000,0.000820721150735},
                {0.171875000000000,0.000696530949538}};
    }
}